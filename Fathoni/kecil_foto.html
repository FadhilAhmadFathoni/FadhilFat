<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Image Compression</title>
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.4/dist/sweetalert2.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background-color: #f4f4f9;
      padding: 10px;          /* Ruang di sekitar konten */
  margin: 0;
  font-family: Arial, sans-serif;
  box-sizing: border-box;
    }
    img {
  display: block;         /* Menghapus spasi tambahan di bawah gambar */
  max-width: 100%;        /* Semua gambar mengikuti lebar container */
  height: auto;           /* Tinggi gambar mengikuti lebar */
}
    input[type="file"] {
      margin: 20px 0;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    #imagePreview {
      margin: 20px 0;
      max-width: 100%;
      max-height: 400px;
    }
    button {
      padding: 10px 20px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    #fileInfo {
      margin: 10px 0;
      font-size: 16px;
    }
    .file-info {
      margin-bottom: 10px;
      font-size: 14px;
    }
    .file-container {
      margin: 20px 0;
      text-align: left;
    }
    .preview-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 20px;
      border: 1px solid #ddd;
      padding: 10px;
      border-radius: 5px;
      background-color: #fff;
    }
    .preview-container img {
      max-width: 150px;
      margin-right: 15px;
      border-radius: 5px;
    }
    .preview-container div {
      font-size: 14px;
      margin-top: 10px;
    }
    .download-btn {
  display: flex;
  justify-content: center;  /* Menyusun isi di tengah horizontal */
  align-items: center;      /* Menyusun isi di tengah vertikal */
  background-color: #4CAF50;
  color: white;
  padding: 10px 20px;
  font-size: 16px;
  font-weight: bold;
  border-radius: 5px;
  cursor: pointer;
  transition: background-color 0.3s ease;
  width: auto;              /* Tombol menyesuaikan lebar konten */
  max-width: 100%;          /* Pastikan tombol tidak melampaui lebar layar */
  text-align: center;       /* Mengatur teks agar rata tengah */
}

/* Efek hover */
.download-btn:hover {
  background-color: #45a049;
}

.download-btn:active {
  background-color: #388e3c;
}

.download-btn:focus {
  outline: none;
}

/* Styling untuk ikon dalam tombol */
.download-btn .icon {
  margin-right: 8px; /* Memberikan jarak antara ikon dan teks */
  font-size: 18px;   /* Menyesuaikan ukuran ikon */
}
    .icon {
      margin-right: 10px;
    }
    .preview-container {
  display: flex;
  flex-direction: column; /* Tumpuk elemen secara vertikal */
  align-items: center;    /* Posisikan elemen di tengah */
  margin-bottom: 20px;
  border: 1px solid #ddd;
  padding: 10px;
  border-radius: 5px;
  background-color: #fff;
  width: 100%;            /* Kontainer akan mengambil lebar penuh */
  max-width: 400px;       /* Maksimal lebar kontainer (opsional) */
  margin: 0 auto;
}
/* Gaya untuk container perbandingan gambar */
.comparison-container {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 20px;
  margin-top: 20px;
  flex-wrap: wrap;
}

/* Gaya untuk gambar dan label, memastikan label tetap di bawah gambar */
.comparison-container .image-container {
  display: flex;
  flex-direction: column; /* Gambar dan label disusun vertikal */
  align-items: center;
  max-width: 300px; /* Maksimal lebar gambar container */
}

/* Gaya untuk gambar asli dan gambar kompresi */
.comparison-container img {
  max-width: 100%;
  height: auto;
  max-height: 300px; /* Batasi tinggi gambar agar tidak terlalu besar */
  object-fit: contain; /* Menjaga proporsi gambar */
}

.preview-container img {
  max-width: 100%;        /* Gambar akan menyesuaikan lebar container */
  height: auto;           /* Tinggi akan mengikuti proporsi lebar */
  border-radius: 5px;     /* Sudut gambar membulat */
  margin-bottom: 10px;    /* Jarak antara gambar dan keterangan */
}

.file-info {
  text-align: center;     /* Teks keterangan di tengah */
  font-size: 14px;        /* Ukuran teks lebih kecil */
  color: #555;
  margin-top: 5px;           
}
/* Styling untuk input file */
#fileInput {
  display: none; /* Sembunyikan input asli */
}

/* Custom button untuk menggantikan input file */
#fileInputLabel {
  display: inline-block;
  background-color: #4CAF50;
  color: white;
  padding: 10px 20px;
  font-size: 16px;
  font-weight: bold;
  text-align: center;
  border-radius: 5px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

#fileInputLabel:hover {
  background-color: #45a049;
}

#fileInputLabel:active {
  background-color: #388e3c;
}

#fileInputLabel:focus {
  outline: none;
}

/* Menambahkan gaya untuk label input file */
#fileInputLabel {
  display: inline-block;
  cursor: pointer;
}
/* Untuk layar dengan lebar maksimal 320px */
@media (max-width: 320px) {
  body {
    padding: 2px; /* Mengurangi padding untuk layar lebih kecil */
  }

  h1 {
    font-size: 18px; /* Mengurangi ukuran font header */
  }

  input[type="file"] {
    width: 100%; /* Input file tetap mengambil lebar penuh */
    margin: 8px 0; /* Mengurangi margin */
  }

  button {
    width: 100%; /* Tombol mengambil lebar penuh */
    margin: 8px 0; /* Mengurangi margin */
  }

  .preview-container {
    max-width: 100%; /* Kontainer gambar tetap mengambil lebar penuh */
    margin: 0 auto; /* Pusatkan kontainer */
  }

  .preview-container img {
    max-width: 85%; /* Gambar sedikit lebih kecil agar sesuai dengan layar kecil */
    height: auto;   /* Tinggi mengikuti proporsi lebar */
  }

  .file-info {
    font-size: 10px; /* Ukuran teks lebih kecil */
  }

  .download-btn {
    width: 100%; /* Tombol download mengambil lebar penuh */
    font-size: 12px; /* Ukuran font lebih kecil */
    padding: 6px 12px;
  }
  .download-btn .icon {
    font-size: 14px; /* Mengurangi ukuran ikon di layar 320px */
  }
}
  </style>
</head>
<body>

  <h1><i class="fas fa-compress"></i> Kecilkan Ukuran Gambar </h1>
  <input type="file" id="fileInput" accept="image/*" multiple onchange="loadImages(event)">
  <label id="fileInputLabel" for="fileInput">
    <i class="fas fa-upload"></i> Upload Gambar
  </label>  
  <br>
  <div id="fileInfo"></div>
  <br>
  <div id="imagePreviews"></div>
  <br>
  <button onclick="compressImages()"><i class="fas fa-compress-arrows-alt"></i> Compress Images</button>
  <br>
  <div id="downloadLinks" class="file-container"></div>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.4/dist/sweetalert2.all.min.js"></script>
  <script>
    let originalFiles = [];
let previewDiv = null; // Definisikan variabel global untuk previewDiv

// Menangani file yang diunggah
function loadImages(event) {
  const files = event.target.files;
  originalFiles = [];  // Reset array sebelum memuat file baru
  const fileInfoDiv = document.getElementById('fileInfo');
  previewDiv = document.getElementById('imagePreviews'); // Inisialisasi previewDiv
  
  // Clear previous info and previews
  fileInfoDiv.innerHTML = '';
  previewDiv.innerHTML = '';

  for (let i = 0; i < files.length; i++) {
    const file = files[i];
    const reader = new FileReader();

    reader.onload = function(e) {
      const img = new Image();
      img.onload = function() {
        const previewContainer = document.createElement('div');
        previewContainer.classList.add('preview-container');

        const preview = document.createElement('img');
        preview.src = e.target.result;

        const fileSizeMB = (file.size / (1024 * 1024)).toFixed(2);
        const fileName = document.createElement('div');
        fileName.classList.add('file-info');
        fileName.innerHTML = `<i class="fas fa-image icon"></i>${file.name} - ${fileSizeMB} MB`;

        previewContainer.appendChild(preview);
        previewContainer.appendChild(fileName);

        previewDiv.appendChild(previewContainer);

        // Store file in array
        originalFiles.push({ file: file, image: img });
      };
      img.src = e.target.result;
    };
    reader.readAsDataURL(file);
  }
}

// Mengompres gambar dan menampilkan perbandingan
function compressImages() {
  if (originalFiles.length === 0) {
    Swal.fire({
  icon: 'warning',
  title: 'Tidak Ada File Yang Diupload!',
  text: 'Harap unggah gambar terlebih dahulu sebelum mengompres.',
});
    return;
  }

  const downloadLinksContainer = document.getElementById('downloadLinks');
  downloadLinksContainer.innerHTML = ''; // Clear previous download links

  originalFiles.forEach((item, index) => {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');

    const maxWidth = 1024;
    const maxHeight = 1024;
    let width = item.image.width;
    let height = item.image.height;

    if (width > height) {
      if (width > maxWidth) {
        height *= maxWidth / width;
        width = maxWidth;
      }
    } else {
      if (height > maxHeight) {
        width *= maxHeight / height;
        height = maxHeight;
      }
    }

    canvas.width = width;
    canvas.height = height;
    ctx.drawImage(item.image, 0, 0, width, height);

    canvas.toBlob(function(blob) {
      const compressedImageURL = URL.createObjectURL(blob);

      // Mengambil nama file asli tanpa ekstensi
      const fileNameWithoutExtension = item.file.name.substring(0, item.file.name.lastIndexOf('.'));
      const fileExtension = item.file.name.substring(item.file.name.lastIndexOf('.'));
      const newFileName = fileNameWithoutExtension + "_kecil" + fileExtension;

     // Menampilkan perbandingan gambar
const comparisonContainer = document.createElement('div');
comparisonContainer.classList.add('comparison-container');

// Gambar Asli
const originalImg = document.createElement('img');
originalImg.src = URL.createObjectURL(item.file);
const originalSize = (item.file.size / (1024 * 1024)).toFixed(2);
const originalLabel = document.createElement('div');
originalLabel.classList.add('file-info');
originalLabel.innerHTML = `${item.file.name} - ${originalSize} MB (Original)`;

// Gambar Kompresi
const compressedImg = document.createElement('img');
compressedImg.src = compressedImageURL;
const compressedSize = (blob.size / (1024 * 1024)).toFixed(2);
const compressedLabel = document.createElement('div');
compressedLabel.classList.add('file-info');
compressedLabel.innerHTML = `${item.file.name} - ${compressedSize} MB (Compressed)`;

// Menambahkan gambar dan label ke container
comparisonContainer.appendChild(originalImg);
comparisonContainer.appendChild(originalLabel);
comparisonContainer.appendChild(compressedImg);
comparisonContainer.appendChild(compressedLabel);

// Menambahkan container ke previewDiv
previewDiv.appendChild(comparisonContainer);

      // Membuat link download untuk setiap file
      const downloadLink = document.createElement('a');
      downloadLink.href = compressedImageURL;
      downloadLink.download = newFileName;
      downloadLink.innerHTML = `<i class="fas fa-download icon"></i> Download ${item.file.name} (kecil)`;
      downloadLink.classList.add('download-btn');
      downloadLinksContainer.appendChild(downloadLink);

      // SweetAlert untuk memberi tahu bahwa file telah dikompresi
Swal.fire({
  icon: 'success',
  title: 'Gambar Telah Dikompresi!',
  text: `${item.file.name} telah berhasil dikompresi.`,
});
    }, 'image/jpeg', 0.7); // Set the quality to 0.7 (70% quality)
  });
}
// Reset semua data ketika halaman di-refresh
window.onload = function() {
  document.getElementById('fileInput').value = ''; // Menghapus input file
  document.getElementById('fileInfo').innerHTML = ''; // Menghapus informasi file
  document.getElementById('imagePreviews').innerHTML = ''; // Menghapus preview gambar
  document.getElementById('downloadLinks').innerHTML = ''; // Menghapus link download
}
  </script>
  
</body>
</html>

